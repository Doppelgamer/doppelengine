// Generated by CoffeeScript 1.6.3
(function() {
	var body, dims, mobiles, move, onkey, plr, stage, surfaces, testFloor, ws, wsUrl;

	dims = {
		w : 200,
		h : 200
	};

	stage = new Kinetic.Stage({
		container : 'container',
		width : dims.w,
		height : dims.h
	});

	surfaces = new Kinetic.Layer();

	testFloor = new Kinetic.Line({
		points : [ 0, dims.h - 0, 200, dims.h - 200 ],
		stroke : 'blue',
		strokeWidth : 1
	});

	surfaces.add(testFloor);

	stage.add(surfaces);

	mobiles = new Kinetic.Layer();

	plr = new Kinetic.Rect({
		x : 100,
		y : 100,
		width : 2,
		height : 4,
		fill : 'black',
		stroke : 'black',
		strokeWidth : 1
	});

	mobiles.add(plr);

	stage.add(mobiles);

	move = function(pos) {
		plr.setX(pos.x);
		plr.setY(dims.h - pos.y);
		return stage.draw();
	};

	wsUrl = "ws://127.0.0.1:9000/test?username=jb";

	ws = new WebSocket(wsUrl);

	ws.onopen = function(evt) {
		return console.log("websocket opened");
	};

	ws.onmessage = function(evt) {
		var pos;
		pos = JSON.parse(evt.data);
		return move(pos);
	};

	onkey = function(evt) {
		var cmd;
		cmd = {
			type : evt.type,
			data : evt.keyCode
		};
		return ws.send(JSON.stringify(cmd));
	};

	body = document.getElementById('body');

	body.onkeydown = onkey;

	body.onkeyup = onkey;

}).call(this);
